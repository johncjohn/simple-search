<!DOCTYPE html>
<html>
<head>
	<title>Dashboard</title>
	<link rel="stylesheet" href="/static/css/dashboard.css">
	<style>
		.privilege-category {
			background-color: #f1f1f1;
			border: 1px solid #ddd;
			padding: 10px;
			margin-bottom: 10px;
			cursor: pointer;
			overflow: hidden;
			position: relative;
		}

		.privilege-category h3 {
			margin-top: 0;
			margin-bottom: 5px;
		}

		.privilege-category .privileges {
			display: none;
			position: absolute;
			top: 100%;
			left: 0;
			background-color: #fff;
			border: 1px solid #ddd;
			width: 100%;
			padding: 10px;
			box-sizing: border-box;
			z-index: 1;
		}

		.privilege-category.active .privileges {
			display: block;
		}
	</style>
</head>
<body>
	<header>
		<h1>Dashboard</h1>
		<div class="role-selector">
			<label>Role:</label>
			<select id="role-select">
				<option value="">--Select a role--</option>
				{% for role in roles %}
					<option value="{{ role }}" {% if role == active_role %}selected{% endif %}>{{ role }}</option>
				{% endfor %}
			</select>
		</div>
		<p>Welcome, {{ username }}!</p>
	</header>
	<div id="privileges-list"></div> <!-- Add an empty div to display the privileges -->
	<script>
		const roleSelect = document.getElementById('role-select');
		const privilegesList = document.getElementById('privileges-list');

		const privileges = {{ privileges|tojson }}; // Get the privileges object passed from the server

		const activeRole = "{{ active_role }}";

		// Update the privileges list to the active role's privileges
		updatePrivilegesList(privileges[activeRole]);

		roleSelect.addEventListener('change', () => {
			const selectedRole = roleSelect.value;
			if (selectedRole) {
				// Update the privileges list to the selected role's privileges
				updatePrivilegesList(privileges[selectedRole]);
			} else {
				// Update to the active role's privileges when no role is selected
				updatePrivilegesList(privileges[activeRole]);
			}
		});

		function updatePrivilegesList(rolePrivileges) {
			privilegesList.innerHTML = Object.entries(rolePrivileges).map(([category, privileges]) => `
				<div class="privilege-category">
					<h3>${category}</h3>
					<div class="privileges">
						${privileges.map(privilege => `<p>${privilege}</p>`).join('')}
					</div>
				</div>`).join('');

			const categories = privilegesList.querySelectorAll('.privilege-category');

			categories.forEach(category => {
				category.addEventListener('click', () => {
					category.classList.toggle('active');
				});
			});
		}
	</script>
</body>
</html>
